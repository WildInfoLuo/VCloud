<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yc.vcloud.mapper.VCUploadFileMapper">
	<select id="getFiles" parameterType="VCUploadFile" resultType="VCUploadFile">
		select ufid,userid,filepath,filesize,to_char(uploaddate,'yyyy-mm-dd HH24:MI:ss') uploaddate,filestatus,stoppoingpath,status,isdir,isdel 
		 from uploadfile where userid=#{userid} and isdel = 0 
		 <if test="filepath != null">
		 	 and regexp_like(filepath,'^'||#{filepath}||'+')
		 </if>
	</select>
	
	<insert id="insertFile" parameterType="VCUploadFile">
		insert into uploadfile values(seq_ufid.nextval,#{userid},#{filepath},0,to_date(#{uploaddate},'yyyy-mm-dd HH24:MI:ss'),1,null,1,1,null,null,0)
	</insert>
	
	<select id="getAllPhoto" parameterType="VCUploadFile" resultType="VCUploadFile">
		select ufid,userid,filepath,filesize,to_char(uploaddate,'yyyy"年"mm"月"dd"日"') uploaddate,filestatus,stoppoingpath,status,isdir,temp1,temp2,isdel 
		 from uploadfile where userid=#{userid} and isdir=0 and temp1='图片'
	</select>
	
	<insert id="uploadFile" parameterType="VCUploadFile">
		insert into uploadfile values(seq_ufid.nextval,#{userid},#{filepath},#{filesize},to_date(#{uploaddate},'yyyy-mm-dd HH24:MI:ss'),1,null,1,0,#{temp1},#{temp2},0)
	</insert>
	
	<select id="getPhotoCount" resultType="VCUploadCount">
		select to_char(uploaddate,'yyyy"年"mm"月"dd"日"') uploaddate,count(*) count from uploadfile  where isdir=0 and temp1='图片'
		group by uploaddate  order by uploaddate desc
	</select>
	
	<update id="delFiles" parameterType="String">
		update uploadfile set isdel = 1 
		<where>
			<!-- regexp_like(filepath,'^'||#{paths}||'+') -->
			filepath like #{paths}||'%'
		</where>
	</update>
	
	<insert id="insertRecyle" parameterType="VCRecyle">
		insert into VCRecyle values(seq_rid.nextval,#{userid},to_date(#{deletedate},'yyyy-mm-dd HH24:MI:ss'),7,#{deletepath},null)
	</insert>
	
	<select id="getUserRecyle" parameterType="int" resultType="VCRecyle">
		select rid,userid,to_char(deletedate,'yyyy-mm-dd HH24:MI:ss') deletedate,lefttime,deletepath from VCRecyle where userid=#{userid}
	</select>
	
	<select id="getAllDoc" parameterType="VCUploadFile" resultType="VCUploadFile">
		select ufid,userid,filepath,filesize,to_char(uploaddate,'yyyy-mm-dd HH:MI:ss') uploaddate,filestatus,stoppoingpath,status,isdir,temp1,temp2,rownum
		 from uploadfile where userid=#{userid} and isdir=0 and temp1='文档' order by uploaddate desc
	</select>
	
	<select id="getDocCount" resultType="VCUploadCount">
		select count(*) count from uploadfile  where isdir=0 and temp1='文档'
	</select>
	
	<select id="getAllMusic" parameterType="VCUploadFile" resultType="VCUploadFile">
		select ufid,userid,filepath,filesize,to_char(uploaddate,'yyyy-mm-dd HH:MI:ss') uploaddate,filestatus,stoppoingpath,status,isdir,temp1,temp2,rownum
		 from uploadfile where userid=#{userid} and isdir=0 and temp1='音乐' order by uploaddate desc
	</select>
	
	<select id="getMusicCount" resultType="VCUploadCount">
		select count(*) count from uploadfile  where isdir=0 and temp1='音乐'
	</select>
	
	<select id="getAllFileWang" parameterType="VCUploadFile" resultType="VCUploadFile">
		select ufid,userid,filepath,filesize,to_char(uploaddate,'yyyy-mm-dd HH:MI:ss') uploaddate,filestatus,stoppoingpath,status,isdir,temp1,temp2,rownum
		 from uploadfile where userid=#{userid} and filepath=#{filepath} and isdir=0  order by uploaddate desc
	</select>
</mapper>
